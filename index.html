<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Audio Mixer with Triggers</title>
</head>
<body>
  <h1>Random Audio Mixer with Triggers</h1>

  <!-- Audio Players for Triggers -->
  <h2>Available Triggers</h2>
  <div id="triggerPlayers"></div>

  <button id="playMixedAudio">Play Mixed Audio</button>

  <script>
    // Manually define audio file paths
    const mainAudioFiles = [
      "audio/00001.m4a",
      "audio/00002.m4a",
      "audio/00003.m4a",
      "audio/00004.m4a",
      "audio/00005.m4a",
      "audio/00006.m4a",
      "audio/00009.m4a",
      "audio/00010.m4a",
      "audio/00087.m4a",
      "audio/00350.m4a"
    ];
    
    const triggerAudioFiles = [
      "triggers/mixkit-hard-typewriter-click-1119.wav",
      "triggers/mixkit-modern-technology-select-3124.wav",
      "triggers/mixkit-mouse-click-close-1113.wav"
    ];

    // Create audio players for each trigger
    const triggerPlayersDiv = document.getElementById('triggerPlayers');
    triggerAudioFiles.forEach((triggerFile) => {
      const audioPlayer = document.createElement('audio');
      audioPlayer.src = triggerFile;
      audioPlayer.controls = true;
      triggerPlayersDiv.appendChild(audioPlayer);
      triggerPlayersDiv.appendChild(document.createElement('br'));
    });

    function loadAudioBuffer(context, url) {
      return fetch(url)
        .then(response => response.arrayBuffer())
        .then(data => context.decodeAudioData(data));
    }

    async function playMixedAudio() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();

      // Select random main audio
      const randomMain = mainAudioFiles[Math.floor(Math.random() * mainAudioFiles.length)];

      const [mainBuffer, ...triggerBuffers] = await Promise.all([
        loadAudioBuffer(audioContext, randomMain),
        ...triggerAudioFiles.map(file => loadAudioBuffer(audioContext, file)),
      ]);

      // Create a mixed buffer with the same duration as the main audio
      const mixedBuffer = audioContext.createBuffer(
        mainBuffer.numberOfChannels,
        mainBuffer.length,
        mainBuffer.sampleRate
      );

      // Copy main audio into the mixed buffer
      for (let channel = 0; channel < mixedBuffer.numberOfChannels; channel++) {
        mixedBuffer.copyToChannel(mainBuffer.getChannelData(channel), channel);
      }

      // Mix triggers at random positions
      triggerBuffers.forEach(triggerBuffer => {
        const randomOffset = Math.random() * (mixedBuffer.duration - triggerBuffer.duration);
        for (let channel = 0; channel < mixedBuffer.numberOfChannels; channel++) {
          const mainData = mixedBuffer.getChannelData(channel);
          const triggerData = triggerBuffer.getChannelData(Math.min(channel, triggerBuffer.numberOfChannels - 1));
          const triggerStartSample = Math.floor(randomOffset * mixedBuffer.sampleRate);

          for (let i = 0; i < triggerBuffer.length; i++) {
            if (triggerStartSample + i < mainData.length) {
              mainData[triggerStartSample + i] += triggerData[i];
            }
          }
        }
      });

      // Play the mixed audio
      const source = audioContext.createBufferSource();
      source.buffer = mixedBuffer;
      source.connect(audioContext.destination);
      source.start();
    }

    document.getElementById('playMixedAudio').addEventListener('click', playMixedAudio);
  </script>
</body>
</html>
